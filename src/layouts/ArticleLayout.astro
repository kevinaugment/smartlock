---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  article: CollectionEntry<'articles'>;
}

const { article } = Astro.props;
const { title, description, pubDate, readingTime, tags, category } = article.data;
const { Content, headings } = await article.render();

// Format date
const formattedDate = new Date(pubDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={title} description={description}>
  <article class="mx-auto max-w-4xl px-4 py-12 sm:px-6 lg:px-8">
    <!-- Breadcrumbs -->
    <nav class="mb-8 text-sm text-gray-600">
      <a href="/" class="hover:text-gray-900">Home</a>
      <span class="mx-2">/</span>
      <a href={`/${category}`} class="capitalize hover:text-gray-900"
        >{category}</a
      >
      <span class="mx-2">/</span>
      <span class="text-gray-900">{title}</span>
    </nav>

    <!-- Article Header -->
    <header class="mb-12">
      <h1 class="text-4xl font-bold text-gray-900 md:text-5xl">
        {title}
      </h1>
      <p class="mt-4 text-xl text-gray-600">
        {description}
      </p>
      <div class="mt-6 flex items-center space-x-4 text-sm text-gray-500">
        <time datetime={pubDate.toISOString()}>{formattedDate}</time>
        <span>•</span>
        <span>{readingTime} min read</span>
        <span>•</span>
        <span class="capitalize">{category}</span>
      </div>
      <!-- Tags -->
      {
        tags && tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800">
                {tag}
              </span>
            ))}
          </div>
        )
      }
    </header>

    <!-- Table of Contents (for long articles) -->
    {
      headings && headings.length > 3 && (
        <aside class="mb-12 rounded-lg border border-gray-200 bg-gray-50 p-6">
          <h2 class="mb-4 text-lg font-bold text-gray-900">
            Table of Contents
          </h2>
          <nav class="space-y-2">
            {headings
              .filter((h) => h.depth <= 2)
              .map((heading) => (
                <a
                  href={`#${heading.slug}`}
                  class:list={[
                    'block text-sm hover:text-primary-600',
                    heading.depth === 1 ? 'font-medium text-gray-900' : 'pl-4 text-gray-600',
                  ]}
                >
                  {heading.text}
                </a>
              ))}
          </nav>
        </aside>
      )
    }

    <!-- Article Content -->
    <div class="prose prose-lg max-w-none prose-headings:font-bold prose-a:text-primary-600 hover:prose-a:text-primary-700 prose-code:text-pink-600 prose-pre:bg-gray-900">
      <Content />
    </div>

    <!-- Related Resources -->
    {
      (article.data.relatedTools || article.data.relatedArticles) && (
        <div class="mt-16 border-t border-gray-200 pt-12">
          <h2 class="text-2xl font-bold text-gray-900">Related Resources</h2>
          
          {article.data.relatedTools && article.data.relatedTools.length > 0 && (
            <div class="mt-6">
              <h3 class="text-lg font-semibold text-gray-800">
                Interactive Tools
              </h3>
              <div class="mt-4 space-y-3">
                {article.data.relatedTools.map((tool) => (
                  <a
                    href={`/tools/${tool}`}
                    class="block rounded-lg border border-gray-200 p-4 hover:border-primary-300 hover:bg-blue-50"
                  >
                    <span class="font-medium text-primary-600">
                      {tool
                        .split('-')
                        .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
                        .join(' ')}
                    </span>
                  </a>
                ))}
              </div>
            </div>
          )}

          {article.data.relatedArticles && article.data.relatedArticles.length > 0 && (
            <div class="mt-8">
              <h3 class="text-lg font-semibold text-gray-800">
                Further Reading
              </h3>
              <div class="mt-4 space-y-3">
                {article.data.relatedArticles.map((slug) => (
                  <a
                    href={`/${article.data.category}/${slug}`}
                    class="block rounded-lg border border-gray-200 p-4 hover:border-primary-300 hover:bg-blue-50"
                  >
                    <span class="font-medium text-gray-900">
                      {slug
                        .split('-')
                        .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
                        .join(' ')}
                    </span>
                  </a>
                ))}
              </div>
            </div>
          )}
        </div>
      )
    }

    <!-- Back to category -->
    <div class="mt-12">
      <a
        href={`/${category}`}
        class="inline-flex items-center text-primary-600 hover:text-primary-700"
      >
        ← Back to {category.charAt(0).toUpperCase() + category.slice(1)} Articles
      </a>
    </div>
  </article>
</BaseLayout>
